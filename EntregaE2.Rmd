---
title: "Ejercicio para entregar 2"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r librarias, echo=FALSE}
library(ggplot2)
library(xlsx)
```

```{r rutas, echo=FALSE}
ruta_datos = "/home/auri/Facultad/Doc/Materias/MRyA/Practicas/Entregas/"
system(command = "mkdir Entregas/Salidas_Entregas") 
ruta_salidas = "/home/auri/Facultad/Doc/Materias/MRyA/Practicas/Entregas/Salidas_Entregas" 
```


```{r apertura, echo=FALSE}
datos = as.data.frame(read.xlsx(paste(ruta_datos, "/Datos_EjercicioEntrega2.xlsx", sep = ""), sheetIndex = 1, endRow = 366))
```

## a. Análisis de consistencia
Primero realizo un control de calidad de los datos. Como el archivo .xlsx fue leido con la función "read.xlsx", los espacios en blancos fueron reemplazados automaticamente por "NA". Por otro lado, la longitud de la serie temporal total es de 365 días tal como índica el enunciado.

Cantidad de datos faltantes de la serie de la estación convencional:
```{r}
length(which(is.na(datos$Aeroparque)))
```


Cantidad de datos faltantes de la serie de la estación automática:
```{r}
length(which(is.na(datos$Est..Automática)))
```

Como solo son 5 datos faltantes en la est. convencional y la est. automatica no presenta datos faltantes, elimino el par de datos en cada caso

```{r}
datos$Est..Automática[which(is.na(datos$Aeroparque))] = NA
```


Analizo ambas series temporales


```{r, echo=FALSE, fig.cap = "Series de temperatura máxima de estaciones convencional (azul) y automática (roja) durante el año 2005"}
gg1 = ggplot(data = datos, aes(x = datos[,1], y = datos[,3])) + theme_minimal() + 
  geom_line(aes(colour = "Automatica")) + 
  geom_line(aes(y = Aeroparque, colour = "Convencional")) + 
  scale_colour_manual(breaks = c("Automatica", "Convencional"), values = c("firebrick", "dodgerblue4"), name = "") +
  scale_y_continuous(breaks = seq(0,50, by = 5))+
  ylab("ºC") + xlab("Año") + ggtitle("Series de Temperatura - 2005") + 
   theme_minimal() +
  theme(axis.text.y   = element_text(size = 14), axis.text.x   = element_text(size = 14), axis.title.y  = element_text(size = 14),
        axis.title.x  = element_text(size = 14),
        panel.border = element_rect(colour = "black", fill = NA, size = 1),
        panel.ontop = F,
        plot.title = element_text(hjust = 0.5)) + theme(legend.position = "bottom", legend.text = element_text(size = 12))

ggsave(paste(ruta_salidas,"/EE2.a_.jpg",sep =""), plot = gg1, width = 25, height = 15, units = "cm")

gg1
```

En ambas estaciones se observa la presencia del ciclo anual de la temperatura, con valores que parecen ser mas elevados para la estación automática. Ademas, la estación automática se observa un valor extremo de mas de 50ºC en los primeros dias de abril de 2005. Este valor extremo lo voy asumir como un error y reemplazar con "NA" el par de datos para ese día.

```{r}
datos[which(datos$Est..Automática == max(datos$Est..Automática, na.rm = T)),2:3] = NA
```

Ahora exploro la relación entre las variables mediante un gráfico de dispersión
```{r, echo=F, fig.cap= "Gráfico de despersión entre los datos de la estación convencional (eje x) y automática (eje y) ", warning=FALSE}
gg2 = ggplot(data = datos, aes(x = datos[,2], datos[,3])) + theme_minimal() +
  geom_point(color = "forestgreen", size = 2) +
  scale_x_continuous(breaks = seq(5, 40, by = 5), limits = c(5, 40)) +
  scale_y_continuous(breaks = seq(5, 40, by = 5), limits = c(5, 40)) +
  ylab("Est. Automática") + xlab("Est. Convencional") + ggtitle("Est. Convencional vs Est. Automática") +
  theme(axis.text.y   = element_text(size = 14), axis.text.x   = element_text(size = 14), axis.title.y  = element_text(size = 14),
        axis.title.x  = element_text(size = 14),
        panel.border = element_rect(colour = "black", fill = NA, size = 1),
        panel.ontop = F,
        plot.title = element_text(hjust = 0.5)) + theme(legend.position = "bottom", legend.text = element_text(size = 12))


ggsave(paste(ruta_salidas,"/EE2.a2_.jpg",sep =""), plot = gg2, width = 25, height = 23, units = "cm")
gg2
```



